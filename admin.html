<!doctype html>
<html lang="zh" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AbeiTools ç®¡ç†åå°</title>
  <meta name="description" content="AbeiTools AIå¯¼èˆªç«™ç®¡ç†ç•Œé¢" />
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial; }
    .modal { backdrop-filter: blur(8px); }
  </style>
</head>
<body class="bg-gray-50 text-slate-800">

  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="bg-white border-b border-gray-200 sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <h1 class="text-xl font-bold text-indigo-600">AbeiTools ç®¡ç†åå°</h1>
          <div class="text-sm text-gray-500">å·¥å…·æ€»æ•°: <span id="totalCount">0</span></div>
        </div>
        <div class="flex items-center gap-3">
          <button id="addToolBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition">
            â• æ·»åŠ å·¥å…·
          </button>
          <button id="exportBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition">
            ğŸ“¥ å¯¼å‡ºæ•°æ®
          </button>
          <a href="index.html" class="text-gray-600 hover:text-gray-800 px-3 py-2 rounded-lg border hover:border-gray-300 transition">
            ğŸ  è¿”å›é¦–é¡µ
          </a>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-6">
    <!-- åˆ†ç±»ç»Ÿè®¡ -->
    <div class="bg-white rounded-2xl border border-gray-200 p-6 mb-6">
      <h2 class="text-lg font-semibold mb-4">åˆ†ç±»ç»Ÿè®¡</h2>
      <div id="categoryStats" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4"></div>
    </div>

    <!-- å·¥å…·åˆ—è¡¨ -->
    <div class="bg-white rounded-2xl border border-gray-200">
      <div class="p-6 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">å·¥å…·ç®¡ç†</h2>
          <div class="flex items-center gap-4">
            <select id="categoryFilter" class="px-3 py-2 border border-gray-300 rounded-lg">
              <option value="">å…¨éƒ¨åˆ†ç±»</option>
            </select>
            <input id="searchInput" type="search" placeholder="æœç´¢å·¥å…·åç§°..." 
              class="px-3 py-2 border border-gray-300 rounded-lg w-60" />
          </div>
        </div>
      </div>
      <div id="toolsList" class="divide-y divide-gray-200"></div>
    </div>
  </main>

  <!-- æ·»åŠ /ç¼–è¾‘å·¥å…·æ¨¡æ€æ¡† -->
  <div id="toolModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto m-4">
      <div class="p-6 border-b border-gray-200">
        <h3 id="modalTitle" class="text-lg font-semibold">æ·»åŠ å·¥å…·</h3>
      </div>
      
      <form id="toolForm" class="p-6 space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ç½‘ç«™URL *</label>
            <input id="urlInput" type="url" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="https://example.com" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">åˆ†ç±» *</label>
            <select id="categoryInput" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
              <option value="">é€‰æ‹©åˆ†ç±»</option>
              <option value="llm">AI å¤§æ¨¡å‹</option>
              <option value="image">AI å›¾åƒ</option>
              <option value="video">AI è§†é¢‘</option>
              <option value="audio">AI éŸ³é¢‘</option>
              <option value="search">AI æœç´¢</option>
              <option value="code">AI ç¼–ç¨‹</option>
              <option value="agent">AI æ™ºèƒ½ä½“</option>
              <option value="workflow">AI å·¥ä½œæµ</option>
              <option value="office">AI åŠå…¬</option>
              <option value="other">å…¶ä»–</option>
            </select>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ä¸­æ–‡åç§° *</label>
            <input id="nameZhInput" type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">è‹±æ–‡åç§° *</label>
            <input id="nameEnInput" type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" />
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ä¸­æ–‡æè¿° *</label>
            <textarea id="descZhInput" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 h-20 resize-none"></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">è‹±æ–‡æè¿° *</label>
            <textarea id="descEnInput" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 h-20 resize-none"></textarea>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">å›¾æ ‡URL (å¯é€‰)</label>
          <input id="iconInput" type="url" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="https://example.com/icon.png (ç•™ç©ºå°†è‡ªåŠ¨è·å–ç½‘ç«™favicon)" />
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ä¸­æ–‡æ ‡ç­¾ (ç”¨é€—å·åˆ†éš”)</label>
            <input id="tagsZhInput" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="æ ‡ç­¾1,æ ‡ç­¾2,æ ‡ç­¾3" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">è‹±æ–‡æ ‡ç­¾ (ç”¨é€—å·åˆ†éš”)</label>
            <input id="tagsEnInput" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="tag1,tag2,tag3" />
          </div>
        </div>

        <div class="flex items-center">
          <input id="sponsorInput" type="checkbox" class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" />
          <label for="sponsorInput" class="ml-2 text-sm text-gray-700">èµåŠ©å•†</label>
        </div>
      </form>

      <div class="p-6 border-t border-gray-200 flex justify-end gap-3">
        <button id="cancelBtn" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
          å–æ¶ˆ
        </button>
        <button id="saveBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
          ä¿å­˜
        </button>
      </div>
    </div>
  </div>

  <script>
    // åˆ†ç±»æ˜ å°„
    const CATEGORY_META = {
      llm:      { name: { zh: "AI å¤§æ¨¡å‹", en: "AI Large Language Models" } },
      image:    { name: { zh: "AI å›¾åƒ", en: "AI Image" } },
      video:    { name: { zh: "AI è§†é¢‘", en: "AI Video" } },
      audio:    { name: { zh: "AI éŸ³é¢‘", en: "AI Audio & Speech" } },
      search:   { name: { zh: "AI æœç´¢", en: "AI Search" } },
      code:     { name: { zh: "AI ç¼–ç¨‹", en: "AI Coding" } },
      agent:    { name: { zh: "AI æ™ºèƒ½ä½“", en: "AI Agents" } },
      workflow: { name: { zh: "AI å·¥ä½œæµ", en: "AI Workflows" } },
      office:   { name: { zh: "AI åŠå…¬", en: "AI Office" } },
      other:    { name: { zh: "å…¶ä»–", en: "Others" } }
    };

    let toolsData = [];
    let editingId = null;

    // DOM å…ƒç´ 
    const $ = (s) => document.querySelector(s);
    const $$ = (s) => Array.from(document.querySelectorAll(s));

    // åŠ è½½æ•°æ®
    function loadData() {
      // æ€»æ˜¯ä»JSONæ–‡ä»¶åŠ è½½æœ€æ–°æ•°æ®ï¼Œç„¶ååŒæ­¥åˆ°localStorage
      fetch('./data/links.json?v=' + Date.now())
        .then(r => {
          if (!r.ok) throw new Error(`HTTP ${r.status}: ${r.statusText}`);
          return r.json();
        })
        .then(data => {
          toolsData = Array.isArray(data) ? data : data.links;
          console.log('æˆåŠŸåŠ è½½æ•°æ®ï¼Œå·¥å…·æ•°é‡:', toolsData.length);
          saveData();
          renderAll();
        })
        .catch(err => {
          console.error('ä»JSONæ–‡ä»¶åŠ è½½æ•°æ®å¤±è´¥:', err);
          // å¦‚æœJSONåŠ è½½å¤±è´¥ï¼Œå°è¯•ä»localStorageæ¢å¤
          const savedData = localStorage.getItem('abeitools_data');
          if (savedData) {
            console.log('ä»localStorageæ¢å¤æ•°æ®');
            toolsData = JSON.parse(savedData);
            renderAll();
          } else {
            alert('åŠ è½½æ•°æ®å¤±è´¥ï¼š' + err.message + '\nè¯·æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ');
          }
        });
    }

    // ä¿å­˜æ•°æ®åˆ°localStorage
    function saveData() {
      localStorage.setItem('abeitools_data', JSON.stringify(toolsData));
    }

    // æ¸²æŸ“æ‰€æœ‰å†…å®¹
    function renderAll() {
      renderStats();
      renderToolsList();
      renderFilters();
    }

    // æ¸²æŸ“åˆ†ç±»ç»Ÿè®¡
    function renderStats() {
      const stats = {};
      Object.keys(CATEGORY_META).forEach(cat => stats[cat] = 0);
      toolsData.forEach(tool => stats[tool.category] = (stats[tool.category] || 0) + 1);

      const container = $('#categoryStats');
      container.innerHTML = '';
      
      Object.entries(stats).forEach(([cat, count]) => {
        const div = document.createElement('div');
        div.className = 'text-center p-3 bg-gray-50 rounded-lg';
        div.innerHTML = `
          <div class="text-2xl font-bold text-indigo-600">${count}</div>
          <div class="text-sm text-gray-600">${CATEGORY_META[cat].name.zh}</div>
        `;
        container.appendChild(div);
      });

      $('#totalCount').textContent = toolsData.length;
    }

    // æ¸²æŸ“å·¥å…·åˆ—è¡¨
    function renderToolsList() {
      const container = $('#toolsList');
      const searchTerm = $('#searchInput').value.toLowerCase();
      const categoryFilter = $('#categoryFilter').value;
      
      const filtered = toolsData.filter(tool => {
        const matchesSearch = !searchTerm || 
          tool.name.zh.toLowerCase().includes(searchTerm) || 
          tool.name.en.toLowerCase().includes(searchTerm) ||
          tool.desc.zh.toLowerCase().includes(searchTerm) ||
          tool.desc.en.toLowerCase().includes(searchTerm);
        const matchesCategory = !categoryFilter || tool.category === categoryFilter;
        return matchesSearch && matchesCategory;
      });

      container.innerHTML = '';
      
      if (filtered.length === 0) {
        container.innerHTML = '<div class="p-8 text-center text-gray-500">æš‚æ— å·¥å…·</div>';
        return;
      }

      filtered.forEach(tool => {
        const row = document.createElement('div');
        row.className = 'p-4 hover:bg-gray-50 transition';
        
        const iconUrl = tool.icon || `https://www.google.com/s2/favicons?domain=${new URL(tool.url).hostname}&sz=32`;
        
        row.innerHTML = `
          <div class="flex items-center gap-4">
            <img src="${iconUrl}" alt="${tool.name.zh}" class="w-10 h-10 rounded-lg flex-shrink-0" 
                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHJ4PSIxMCIgZmlsbD0iI2YxZjVmOSIvPjxwYXRoIGQ9Ik0yMCAxMGE4IDggMCAxIDAgMCAxNkE4IDggMCAwIDAgMjAgMTB6IiBmaWxsPSIjYzNkNGUzIi8+PC9zdmc+';" />
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2 mb-1">
                <h3 class="font-medium text-gray-900">${tool.name.zh}</h3>
                <span class="text-sm text-gray-500">(${tool.name.en})</span>
                <span class="px-2 py-1 text-xs bg-indigo-100 text-indigo-800 rounded-full">${CATEGORY_META[tool.category].name.zh}</span>
              </div>
              <p class="text-sm text-gray-600 mb-2">${tool.desc.zh}</p>
              <div class="flex items-center gap-4 text-xs text-gray-500">
                <span>ğŸ”— ${tool.url}</span>
                <span>ğŸ·ï¸ ${tool.tags.zh.join(', ')}</span>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <button onclick="editTool('${tool.id}')" class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition">
                âœï¸
              </button>
              <button onclick="deleteTool('${tool.id}')" class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition">
                ğŸ—‘ï¸
              </button>
            </div>
          </div>
        `;
        container.appendChild(row);
      });
    }

    // æ¸²æŸ“ç­›é€‰å™¨
    function renderFilters() {
      const select = $('#categoryFilter');
      const currentValue = select.value;
      select.innerHTML = '<option value="">å…¨éƒ¨åˆ†ç±»</option>';
      
      Object.entries(CATEGORY_META).forEach(([cat, meta]) => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = meta.name.zh;
        if (cat === currentValue) option.selected = true;
        select.appendChild(option);
      });
    }

    // æ‰“å¼€æ¨¡æ€æ¡†
    function openModal(title, tool = null) {
      editingId = tool?.id || null;
      $('#modalTitle').textContent = title;
      
      if (tool) {
        $('#urlInput').value = tool.url;
        $('#categoryInput').value = tool.category;
        $('#nameZhInput').value = tool.name.zh;
        $('#nameEnInput').value = tool.name.en;
        $('#descZhInput').value = tool.desc.zh;
        $('#descEnInput').value = tool.desc.en;
        $('#iconInput').value = tool.icon || '';
        $('#tagsZhInput').value = tool.tags.zh.join(',');
        $('#tagsEnInput').value = tool.tags.en.join(',');
        $('#sponsorInput').checked = tool.sponsor;
      } else {
        $('#toolForm').reset();
      }
      
      $('#toolModal').classList.remove('hidden');
      $('#toolModal').classList.add('flex');
    }

    // å…³é—­æ¨¡æ€æ¡†
    function closeModal() {
      $('#toolModal').classList.add('hidden');
      $('#toolModal').classList.remove('flex');
      editingId = null;
    }

    // æ·»åŠ å·¥å…·
    function addTool() {
      console.log('æ‰§è¡ŒaddToolå‡½æ•°');
      openModal('æ·»åŠ å·¥å…·');
    }

    // ç¼–è¾‘å·¥å…·
    function editTool(id) {
      console.log('æ‰§è¡ŒeditToolå‡½æ•°ï¼ŒID:', id);
      const tool = toolsData.find(t => t.id === id);
      if (tool) {
        openModal('ç¼–è¾‘å·¥å…·', tool);
      }
    }

    // åˆ é™¤å·¥å…·
    function deleteTool(id) {
      const tool = toolsData.find(t => t.id === id);
      if (tool && confirm(`ç¡®å®šè¦åˆ é™¤å·¥å…· "${tool.name.zh}" å—ï¼Ÿ`)) {
        toolsData = toolsData.filter(t => t.id !== id);
        saveData();
        renderAll();
      }
    }

    // ä¿å­˜å·¥å…·
    function saveTool() {
      const form = $('#toolForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const toolData = {
        id: editingId || Date.now().toString(),
        url: $('#urlInput').value,
        category: $('#categoryInput').value,
        name: {
          zh: $('#nameZhInput').value,
          en: $('#nameEnInput').value
        },
        desc: {
          zh: $('#descZhInput').value,
          en: $('#descEnInput').value
        },
        icon: $('#iconInput').value || undefined,
        tags: {
          zh: $('#tagsZhInput').value.split(',').map(t => t.trim()).filter(Boolean),
          en: $('#tagsEnInput').value.split(',').map(t => t.trim()).filter(Boolean)
        },
        sponsor: $('#sponsorInput').checked
      };

      if (editingId) {
        const index = toolsData.findIndex(t => t.id === editingId);
        if (index !== -1) {
          toolsData[index] = toolData;
        }
      } else {
        toolsData.push(toolData);
      }

      saveData();
      renderAll();
      closeModal();
    }

    // å¯¼å‡ºæ•°æ®
    function exportData() {
      console.log('æ‰§è¡Œå¯¼å‡ºæ•°æ®ï¼Œå·¥å…·æ•°é‡:', toolsData.length);
      if (!toolsData || toolsData.length === 0) {
        alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
        return;
      }
      
      const dataStr = JSON.stringify({ links: toolsData }, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'links.json';
      document.body.appendChild(link); // ç¡®ä¿é“¾æ¥åœ¨DOMä¸­
      link.click();
      document.body.removeChild(link); // æ¸…ç†DOM
      URL.revokeObjectURL(url);
      console.log('å¯¼å‡ºå®Œæˆ');
    }

    // äº‹ä»¶ç›‘å¬
    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOMåŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
      loadData();

      // ç¡®ä¿æ‰€æœ‰æŒ‰é’®äº‹ä»¶éƒ½æ­£ç¡®ç»‘å®š
      const addBtn = $('#addToolBtn');
      const exportBtn = $('#exportBtn');
      const cancelBtn = $('#cancelBtn');
      const saveBtn = $('#saveBtn');
      const searchInput = $('#searchInput');
      const categoryFilter = $('#categoryFilter');

      if (addBtn) {
        addBtn.addEventListener('click', (e) => {
          console.log('ç‚¹å‡»äº†æ·»åŠ å·¥å…·æŒ‰é’®');
          e.preventDefault();
          addTool();
        });
      } else {
        console.error('æœªæ‰¾åˆ°æ·»åŠ å·¥å…·æŒ‰é’®');
      }

      if (exportBtn) {
        exportBtn.addEventListener('click', (e) => {
          console.log('ç‚¹å‡»äº†å¯¼å‡ºæ•°æ®æŒ‰é’®');
          e.preventDefault();
          exportData();
        });
      } else {
        console.error('æœªæ‰¾åˆ°å¯¼å‡ºæ•°æ®æŒ‰é’®');
      }

      if (cancelBtn) {
        cancelBtn.addEventListener('click', closeModal);
      }

      if (saveBtn) {
        saveBtn.addEventListener('click', (e) => {
          console.log('ç‚¹å‡»äº†ä¿å­˜æŒ‰é’®');
          e.preventDefault();
          saveTool();
        });
      }

      if (searchInput) {
        searchInput.addEventListener('input', renderToolsList);
      }

      if (categoryFilter) {
        categoryFilter.addEventListener('change', renderToolsList);
      }

      // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
      $('#toolModal').addEventListener('click', (e) => {
        if (e.target === $('#toolModal')) {
          closeModal();
        }
      });

      // ESCé”®å…³é—­æ¨¡æ€æ¡†
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !$('#toolModal').classList.contains('hidden')) {
          closeModal();
        }
      });
    });

    // å…¨å±€å‡½æ•°æš´éœ²
    window.editTool = editTool;
    window.deleteTool = deleteTool;
  </script>
</body>
</html>